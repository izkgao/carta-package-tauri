## Prerequisites
- WSL
    - Must be Windows 10 version 2004 and higher (Build 19041 and higher) or Windows 11
    - https://learn.microsoft.com/windows/wsl/install
- Microsoft C++ Build Tools
    - Download and install Microsoft C++ Build Tools https://visualstudio.microsoft.com/visual-cpp-build-tools/
        - Check "Desktop development with C++"
- Rust
    - `winget install --id Rustlang.Rustup`
    - `rustup default stable-msvc`
- Tauri
    - `cargo install tauri-cli`

## Packaging process
> **The commands below must be run in PowerShell, not in WSL.**

1. Prepare frontend and backend
    - Put Linux AppImage to root directory of this repository 
    - Run `wsl.exe bash extract_appimage.sh`
2. Modify configuration
    - Modify `src-tauri/tauri.conf.json`
        - Change `version` to the version of this release
    - Modify `src-tauri/Cargo.toml`
        - Change `version` and `description` to the version of this release
        - DO NOT change `edition` because it is for Rust, not CARTA version.
3. Build tauri app
    ```PowerShell
    cd src-tauri
    # Clean previous build
    cargo clean
    # Build nsis installer
    cargo tauri build --bundles nsis
    ```
4. Get the installer from `src-tauri/target/release/bundle/`

## File and folder description
- `extract_appimage.sh`
    - The script to extract CARTA frontend and backend from Linux AppImage for Windows.
- `src-tauri/build.rs`
    - The build script for Tauri. We should not modify it.
- `src-tauri/Cargo.lock`
    - The Cargo.lock generated from `Cargo.toml`. We should not modify it.
- `src-tauri/Cargo.toml`
    - Here you can set the version and description of the package.
- `src-tauri/Entitlements.plist`
    - This may be necessary for CARTA to work under Apple's new stricter notarization policies. It seems to “allow-unsigned-executable-memory”.
- `src-tauri/tauri.conf.json`
    - Here you can set the name and version of the package.
- `src-tauri/backend/`
    - `etc/data`
        - This should contain the `geodetic` and `ephemerides` folders required by carta-casacore. Grab the latest version from Astron when making a package:
        ```bash
        cd src-tauri/backend/etc/data
        wget https://www.astron.nl/iers/WSRT_Measures.ztar
        tar xfz WSRT_Measures.ztar
        rm WSRT_Measures.ztar
        ```
    - `libs`
        - These are the packaged library files needed by carta-backend from the packaging computer.
    - `bin`
        - `carta-backend`
            - This is the packaged carta-backend executable.
- `src-tauri/frontend/`
    - This contains the built frontend files.
- `src-tauri/capabilities/` & `src-tauri/gen/`
    - These are generated by Tauri. We should not modify them.
- `src-tauri/icons/`
    - These are the icons generated using `cargo tauri icon <path-to-icon>.png`. We should not modify them.
- `src-tauri/src`
    - `lib.rs`
        - This is the source code for CARTA Tauri app.
    - `main.rs`
        - This is the main Rust file for Tauri. We should not modify it.
- `src-tauri/target/`
    - This contains the built files. Can be cleaned using `cargo clean`.